<!DOCTYPE html>
<html>
<head>
	<title>Canvas</title>
	<style type="text/css">
		canvas{
			background-color: gray;
		}
	</style>
</head>
<body>
	<img id="cosa" src="23.png" style="display:none;">
	<canvas id="canvas" width="400" height="300"></canvas>
	<script type="text/javascript">
		var canvas = null, ctx = null, x=0, y=0, direccion = 0;
		var player = null, food = null, score = null, puntaje = 0;
		var pausa = false;

		window.requestAnimationFrame = (function()
		{
			return window.requestAnimationFrame || 
				window.mozRequestAnimationFrame ||
				window.webkitRequestAnimationFrame ||
				function (callback)
				{
					window.setTimeout(callback,17);
				}
		}());

		function Rectangulo(x, y, w, h, c)
		{
			this.x = x;
			this.y = y;
			this.w = w;
			this.h = h;
			this.c = c;

			this.paint = function(ctx)
			{
				ctx.fillStyle = this.c;
				ctx.fillRect(this.x, this.y, this.w, this.h);
			}

			this.intersects = function(target)
			{
				if( this.x < target.x + target.w  && 
					this.x + this.w > target.x    &&
					this.y < target.y + target.h  &&
					this.y + this.h > target.y)
				{
					puntaje++;
					score = new Score(338, 20, puntaje);
					return true;
				}
			}
		}

		function Score(x, y, s)
		{
			this.x = x;
			this.y = y;
			this.s = s;

			this.paint = function(ctx)
			{
				ctx.fillStyle = "#00FF00";
				ctx.font = "15px Arial";
				ctx.fillText("Score:"+this.s, this.x, this.y);
			}
		}



		function paint(ctx)
		{
			ctx.fillStyle = "#000";
			ctx.fillRect(0,0,canvas.width,canvas.height);
			if(pausa)
			{
				ctx.fillStyle = "#00FF00";
				ctx.font = "15px Arial";
				ctx.fillText("Juego pausado ESPACIO para continuar", 60, canvas.height-5);
			}
			player.paint(ctx); 
			food.paint(ctx);
			score.paint(ctx);
		}

		function upt()
		{
			if(!pausa)
			{
				switch(direccion)
				{
					case 0:
						player.x += 2;
						if(player.x>canvas.width)
						 	player.x = -10;
					break;
					case 1:
						player.x -= 2;
						if (player.x<0)
							player.x = canvas.width;
					break;
					case 2:
						player.y += 2;
						if(player.y>=canvas.height)
						 	player.y = -10;
					break;
					case 3:
						player.y -=2;
						if(player.y<0)
						 	player.y = canvas.height;
					break;
				}

				if (player.intersects(food)) 
				{
					food.x = random(canvas.width-10);
					food.y = random(canvas.height-10);
				}
			}
		}

		//se repite mucho
		function run()
		{
			window.requestAnimationFrame(run)
			upt();
			paint(ctx);
		}

		function init()
		{
			canvas = document.getElementById('canvas');
			ctx = canvas.getContext('2d');

			player = new Rectangulo(x,y,10,10,"#00FF00")
			food = new Rectangulo((canvas.width/2-10),(canvas.height/2-10),10,10,"red")
			score = new Score(338, 20, puntaje);

			run();
		}

		window.addEventListener('load',init,false);  

		document.addEventListener('keydown', (e) => 
		{
		  const keyName = event.key;

		  if(keyName == "ArrowUp")
		  {
		  	direccion = 3;
		  }
		  else if(keyName == "ArrowDown")
		  {
		  	direccion = 2;
		  }
		  else if(keyName == "ArrowLeft")
		  {
		  	direccion = 1;
		  }
		  else if(keyName == "ArrowRight")
		  {
		  	direccion = 0;
		  }

		  if(keyName == " ")
		  {
		  	pausa = !pausa;
		  }


		});

		function random(x)
		{
			return Math.floor(Math.random()*x)
		}

	</script>
</body>
	
</html>